# Kufar.by Telegram Bot — Парсер объявлений

Телеграм-бот для отслеживания новых объявлений на kufar.by в выбранной категории.

---

## Архитектура проекта

```
kufar-bot/
├── main.py              # Точка входа. Запускает бот и парсер параллельно
├── config.py            # Все настройки из переменных окружения
├── parser.py            # Парсер kufar.by — тянет объявления по категории
├── state.py             # Управление состоянием (файл state.json на диске)
├── bot.py               # Telegram-бот: обработчики команд и кнопок
├── notifier.py          # Отправка уведомлений о новых объявлениях в Telegram
├── requirements.txt     # Зависимости Python
├── state.json           # Автосоздаётся. Хранит состояние бота (не трогать руками)
└── README.md            # Этот файл
```

### Как всё связано

```
UptimeRobot (пинг каждые 5 мин)
       │
       ▼
Render.com (хостит main.py)
       │
       ├── bot.py          ← обрабатывает команды юзера в Telegram
       ├── parser.py       ← с рандомным интервалом тянет объявления с kufar.by
       ├── state.py        ← читает/пишет state.json на диске Render
       └── notifier.py     ← отправляет новые объявления в Telegram
                                         │
                                         ▼
                                   Telegram (юзер видит уведомления)
```

### Поток данных

1. `main.py` стартует бот и парсер одновременно (два потока)
2. Юзер нажимает **Старт** в боте → `bot.py` меняет состояние в `state.py` на `active`
3. `parser.py` в цикле с рандомным интервалом запрашивает kufar.by по категории
4. Новые объявления (их ID не в `state.json`) попадают в очередь
5. `notifier.py` берёт из очереди и шлёт сообщение в Telegram
6. Юзер нажимает **Стоп** → состояние меняется на `stopped`, дата фиксируется
7. При следующем **Старт** — считается количество пропущенных объявлений

---

## Переменные окружения (Render)

| Переменная | Описание | Пример |
|---|---|---|
| `TELEGRAM_BOT_TOKEN` | Токен бота из @BotFather | `123456:ABC-DEF1234ghIkl` |
| `TELEGRAM_CHAT_ID` | ID чата (можно узнать через @getidsbot) | `123456789` |
| `KUFAR_CATEGORY_ID` | ID категории на kufar.by | `5070` (Фототехника и оптика) |
| `SCAN_INTERVAL_MIN` | Минимальный интервал сканирования в секундах | `41` |
| `SCAN_INTERVAL_MAX` | Максимальный интервал сканирования в секундах | `94` |

---

## Настройка и запуск

### Локально (для тестирования)

```bash
pip install -r requirements.txt
export TELEGRAM_BOT_TOKEN="ваш_токен"
export TELEGRAM_CHAT_ID="ваш_chat_id"
export KUFAR_CATEGORY_ID="5070"
export SCAN_INTERVAL_MIN="41"
export SCAN_INTERVAL_MAX="94"
python main.py
```

### Render.com (продакшн)

1. Создаём новый **Web Service** на render.com
2. Подключаем репо с этим кодом
3. Build command: `pip install -r requirements.txt`
4. Start command: `python main.py`
5. Добавляем переменные окружения из таблицы выше
6. Включаем **Persistent Disk** (чтобы `state.json` не стирался при перезагрузке)
7. Создаём UptimeRobot — пинг на URL сервиса каждые 5 минут

---

## Категории kufar.by (справочник)

| ID | Категория |
|---|---|
| **5000** | **Техника (все)** |
| 5010 | Телефоны |
| 5020 | Аудиотехника |
| 5030 | Компьютеры и комплектующие |
| 5040 | Игры и приставки |
| 5050 | Оргтехника |
| 5060 | ТВ и видеотехника |
| **5070** | **Фототехника и оптика** ← по умолчанию |
| 5080 | Планшеты и электронные книги |
| 5090 | Бытовая техника |
| **1000** | **Недвижимость (все)** |
| 1010 | Квартиры |
| 1020 | Дома, дачи, коттеджи |
| 1030 | Гаражи и стоянки |
| 1040 | Комнаты |
| 1050 | Коммерческая недвижимость |
| 1080 | Участки |
| 1120 | Новостройки |
| **2000** | **Авто и транспорт (все)** |
| 2010 | Легковые авто |
| 2020 | Прицепы |
| 2030 | Мототехника |
| 2040 | Запчасти, расходники |
| 2045 | Аксессуары |
| 2050 | Водный транспорт |
| 2060 | Грузовики и автобусы |
| 2070 | Инструмент, оборудование |
| 2075 | Шины, диски |
| 2080 | Сельхозтехника |
| 2090 | Спецтехника |
| 2100 | Услуги для авто |
| 2110 | Автокресла и бустеры |
| **3000** | **Все для дома** |
| 3040 | Бытовая техника |
| 3060 | Мебель и интерьер |
| 3100 | Посуда и кухонные аксессуары |
| 3110 | Хозяйственные товары |
| 3120 | Комнатные растения |
| 3130 | Бытовые услуги |
| 3140 | Ремонт мебели |
| **4000** | **Хобби, спорт и туризм** |
| 4010 | CD, DVD, пластинки |
| 4020 | Спорттовары |
| 4030 | Антиквариат и коллекции |
| 4040 | Книги и журналы |
| 4050 | Велосипеды |
| 4060 | Охота и рыбалка |
| 4070 | Музыкальные инструменты |
| 4080 | Рукоделие |
| 4090 | Туристические товары |
| 4100 | Прочее |
| 4110 | Туристические услуги |
| **6000** | **Работа, бизнес, учёба** |
| 6010 | Вакансии |
| 6020 | Ищу работу |
| 6040 | Образование |
| 6050 | Готовый бизнес |
| 6090 | Станки и оборудование |
| **7000** | **Прочее** |
| 7010 | Все остальное |
| 7020 | Продукты питания |
| 7030 | Бюро находок |
| 7040 | Спрос |
| 7050 | Медицинские товары |
| 7060 | Канцелярские товары |
| **8000** | **Мода и стиль** |
| 8020 | Аксессуары и часы |
| 8050 | Ремонт и пошив одежды |
| 8060 | Одежда для беременных |
| 8070 | Мужская одежда |
| 8080 | Женская одежда |
| 8090 | Мужская обувь |
| 8100 | Женская обувь |
| 8110 | Косметика и парфюмерия |
| **9000** | **Свадьба и праздники** |
| 9010 | Подарки и праздничные товары |
| 9020 | Свадебные платья |
| 9030 | Свадебные костюмы |
| 9040 | Свадебная обувь |
| 9050 | Свадебные аксессуары |
| 9060 | Услуги для торжеств |
| 9070 | Карнавальные костюмы |
| **10000** | **Сад и огород** |
| 10010 | Садовая мебель и мангалы |
| 10020 | Растения, рассада и семена |
| 10030 | Садовая техника и инвентарь |
| 10040 | Теплицы |
| 10050 | Садовые аксессуары |
| 10060 | Удобрения и агрохимия |
| 10070 | Все для пчеловода |
| 10080 | Прочее для сада и огорода |
| 10090 | Бани, хозблоки, санузлы |
| **11000** | **Животные** |
| 11010 | Домашние питомцы |
| 11020 | Сельхоз животные |
| 11030 | Товары для животных |
| 11040 | Услуги для животных |
| 11050 | Вязка животных |
| **12000** | **Всё для детей и мам** |
| 12010 | Одежда до 1 года |
| 12020 | Детская обувь |
| 12030 | Кроватки, манежи, стульчики |
| 12040 | Ходунки, шезлонги, качели |
| 12050 | Коляски |
| 12060 | Автокресла и бустеры |
| 12070 | Кормление и уход |
| 12080 | Сумки-кенгуру и слинги |
| 12090 | Игрушки и книги |
| 12100 | Детский транспорт |
| 12110 | Товары для мам |
| 12120 | Одежда для беременных |
| 12130 | Прочие товары для детей |
| 12140 | Одежда для девочек |
| 12150 | Одежда для мальчиков |
| 12160 | Текстиль для детей |
| **13000** | **Услуги** |
| 13010 | Услуги для авто |
| 13020 | Бытовые услуги |
| 13030 | Компьютерные услуги, интернет |
| 13040 | Красота и здоровье |
| 13050 | Няни и сиделки |
| 13060 | Услуги переводчика, секретаря |
| 13070 | Перевозки пассажиров и грузов |
| 13080 | Реклама, полиграфия |
| 13090 | Строительные работы |
| 13100 | Сад, благоустройство |
| 13110 | Услуги для животных |
| 13120 | Фото и видеосъемка |
| 13130 | Юридические услуги |
| 13140 | Туристические услуги |
| 13150 | Прочие услуги |
| 13160 | Ремонт и пошив одежды |
| 13170 | Услуги для торжеств |
| 13180 | Ремонт мебели |
| 13190 | Ремонт квартиры, дома |
| **14000** | **Ремонт и стройка** |
| 14010 | Строительный инструмент |
| 14020 | Сантехника |
| 14030 | Стройматериалы |
| 14040 | Отделочные материалы |
| 14050 | Окна и двери |
| 14060 | Прочее для ремонта и стройки |
| 14070 | Строительство и ремонт |
| 14080 | Срубы, бытовки, кунги |
| 14170 | Ремонт квартиры, дома |
```
